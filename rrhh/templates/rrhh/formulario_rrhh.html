{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gray-100">
  <div class="bg-white shadow-md rounded-lg p-8 w-full max-w-xl">

    <h2 class="text-2xl font-bold text-center text-purple-700 mb-6">Datos RRHH</h2>

    <form method="post" class="space-y-4 mb-4">
        {% csrf_token %}
            <div>
              <label for="id_alta" class="block text-gray-700 font-semibold mb-1">Fecha Alta:</label>
              {{ form.alta|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div>
              <label for="id_direccion_centro" class="block text-gray-700 font-semibold mb-1">Dirección del centro:</label>
              {{ form.direccion_centro|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div>
                <label for="id_tipo_contrato" class="block text-gray-700 font-semibold mb-1">Tipo de contrato:</label>
                {{ form.tipo_contrato|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div id="causa_wrapper" class="hidden">
              <label for="id_causa_contrato" class="block font-semibold">Causa:</label>
              {{ form.causa_contrato|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div id="titulacion_wrapper" class="hidden">
              <label for="id_titulacion_y_fecha" class="block font-semibold">Titulación y fecha de obtención:</label>
              {{ form.titulacion_y_fecha|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div>
              <label for="id_jornada" class="block text-gray-700 font-semibold mb-1">Tipo de jornada:</label>
              {{ form.jornada|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div id="horas_wrapper">
              <label for="id_horas_semana" class="block text-gray-700 font-semibold mb-1">Horas por semana:</label>
              {{ form.horas_semana|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div id="distrib_wrapper">
              <label for="id_distribucion_jornada" class="block text-gray-700 font-semibold mb-1" >Distribución de jornada:</label>
              <p>
                De
              <input type="text" name="jornada_dia_inicio" class="inline-block w-20 border border-gray-300 px-1 py-1 rounded" placeholder="lunes" />
                a
              <input type="text" name="jornada_dia_fin" class="inline-block w-20 border border-gray-300 px-1 py-1 rounded" placeholder="viernes" />,
                en horario de
              <input type="text" name="jornada_hora_inicio" class="inline-block w-20 border border-gray-300 px-1 py-1 rounded" placeholder="08" size="2" /> h a
              <input type="text" name="jornada_hora_fin" class="inline-block w-20 border border-gray-300 px-1 py-1 rounded" placeholder="15" size="2" /> h
              </p>
            <div id="observaciones_wrapper" class="hidden">
              <label for="id_observaciones_jornada" class="block text-gray-700 font-semibold mb-1">Observaciones:</label>
              {{ form.observaciones_jornada|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>



            </div>

            <div id="duracion_wrapper">
              <label for="id_duracion" class="block text-gray-700 font-semibold mb-1">Duración del contrato:</label>
              {{ form.duracion|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div>
              <label for="id_prestara_servicios_como" class="block text-gray-700 font-semibold mb-1">
                Prestará sus servicios como:
              </label>
              {{ form.prestara_servicios_como|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>



            <div>
              <label for="id_clausulas_adicionales_rrhh" class="block text-gray-700 font-semibold mb-1">Cláusulas adicionales extraordinarias:</label>
              {{ form.clausulas_adicionales_rrhh|add_class:"border border-gray-300 px-3 py-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500" }}
            </div>

            <div class="text-center">
                <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition duration-200">
                Guardar y continuar
                </button>
            </div>
    </form>
    <div class="text-center mt-4">
      <a href="{% url 'rrhh:rrhh_inicio' %}" class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded">
        ← Volver al menú
      </a>
    </div>
  </div>
</div>
<script>
  function toggleParcialFields() {
    const jornada = document.getElementById("id_jornada");
    const horas = document.getElementById("horas_wrapper");
    const distrib = document.getElementById("distrib_wrapper");
    const observaciones = document.getElementById("observaciones_wrapper");
    if (!jornada || !horas || !distrib || !observaciones) return;

    const esParcial = jornada.value === "Parcial";
    horas.style.display = esParcial ? "block" : "none";
    distrib.style.display = esParcial ? "block" : "none";
    observaciones.style.display = esParcial ? "block" : "none";

  }


  function toggleCamposContrato() {
    const tipoContratoEl = document.getElementById("id_tipo_contrato");
    const causa = document.getElementById("causa_wrapper");
    const titulacion = document.getElementById("titulacion_wrapper");
    const duracion = document.getElementById("duracion_wrapper");

    if (!tipoContratoEl || !causa || !titulacion || !duracion) return;

    const tipoContrato = tipoContratoEl.value;
    console.log("Tipo de contrato seleccionado:", tipoContrato);

    // Listas de valores que requieren mostrar campos
    const contratosQueRequierenCausa = [
      "temporal_produccion_imprevisible",
      "temporal_produccion_previsible",
      "temporal_interinidad"
    ];
    const contratosQueRequierenFecha = [
      "temporal_practicas",
      "pre_doc"
    ];

    const contratosQueRequierenDuracion = [
      "temporal_practicas",
      "pre_doc",
      "temporal_produccion_imprevisible",
      "temporal_produccion_previsible",
      "temporal_interinidad",
      "postdoc",
      "distinguido",
      "temporal_prtr",
      "temporal_fondos_europeos",
    ];

    // Ocultar todos por defecto
    causa.classList.add("hidden");
    titulacion.classList.add("hidden");  // ocultar
    duracion.classList.add("hidden");

    if (contratosQueRequierenCausa.includes(tipoContrato)) {
      causa.classList.remove("hidden");
    }

    if (contratosQueRequierenFecha.includes(tipoContrato)) {
      titulacion.classList.remove("hidden");
    }

    if (contratosQueRequierenDuracion.includes(tipoContrato)) {
      duracion.classList.remove("hidden");
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    toggleParcialFields();
    toggleCamposContrato();

    const jornadaEl = document.getElementById("id_jornada");
    const contratoEl = document.getElementById("id_tipo_contrato");

    if (jornadaEl) {
      jornadaEl.addEventListener("change", toggleParcialFields);
    }

    if (contratoEl) {
      contratoEl.addEventListener("change", toggleCamposContrato);
    }
  });
</script>

{% endblock %}
